

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.2. 3DS Method invocation &mdash; 3DSecure.io  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/scenario_selector.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
  <link rel="stylesheet" href="_static/scenario_selector.css" type="text/css" />
  <link rel="stylesheet" href="_static/doc_table.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.3. Challenge flow" href="challenge_flow.html" />
    <link rel="prev" title="4.1. 3-D Secure version determination" href="versioning.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">1. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-information.html">2. Server information</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">3. API Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="guides.html">4. Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="versioning.html">4.1. 3-D Secure version determination</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. 3DS Method invocation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initiating-3ds-method">Initiating 3DS Method</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#completion">Completion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ds-method-failure">3DS Method failure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="challenge_flow.html">4.3. Challenge flow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">5. Authentication Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">6. Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="sandbox.html">7. Sandbox Testcases</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">8. Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">3DSecure.io</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="guides.html">4. Guides</a> &raquo;</li>
        
      <li>4.2. 3DS Method invocation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/3dsmethod.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ds-method-invocation">
<span id="ds-method"></span><h1>4.2. 3DS Method invocation<a class="headerlink" href="#ds-method-invocation" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only used for browser authentication</p>
</div>
<p>The 3DS Method can be optionally used by issuers to gather browser fingerprints
using Javascript. This is done by loading a URL in a hidden iframe, before the
authentication. This iframe will then execute some fingerprinting javascript,
before POST’ing to the prespecified URL belonging to the requestor.  The 3DS
Method fingerprint result is tied to the authentication by the
<code class="docutils literal notranslate"><span class="pre">threeDSServerTransID</span></code>.</p>
<p>If <a class="reference external" href="reference.html#attr-cardRangeData-threeDSMethodURL">3DS Method URL</a> is included in the <a class="reference internal" href="preauth.html#preauth-usage"><span class="std std-ref">/preauth endpoint</span></a> response, the
3DS method <em>must</em> be invoked as explained in this guide.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">threeDSMethodURL</span></code> <em>is not</em> included in the <code class="docutils literal notranslate"><span class="pre">/preauth</span></code> response (ref.
<a class="reference internal" href="specification_210.html#preauth-response-210"><span class="std std-ref">2.1.0</span></a>, <a class="reference internal" href="specification_220.html#preauth-response-220"><span class="std std-ref">2.1.0</span></a>),
continue with the <a class="reference internal" href="auth.html#auth-usage"><span class="std std-ref">/auth endpoint</span></a> and set <a class="reference external" href="specification_210.html#attr-AReq-threeDSCompInd">3DS Completion indicator</a> to <code class="docutils literal notranslate"><span class="pre">&quot;U&quot;</span></code>, to indicate that the
3DS Method was not available.</p>
<div class="section" id="initiating-3ds-method">
<h2>Initiating 3DS Method<a class="headerlink" href="#initiating-3ds-method" title="Permalink to this headline">¶</a></h2>
<p>Create a JSON object containing <code class="docutils literal notranslate"><span class="pre">threeDSServerTransID</span></code> from the <a class="reference internal" href="preauth.html#preauth-usage"><span class="std std-ref">preauth</span></a> call and the callback URL you wish to receive the POST to in
<code class="docutils literal notranslate"><span class="pre">threeDSMethodNotificationURL</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="nt">&quot;threeDSServerTransID&quot;</span><span class="p">:</span> <span class="s2">&quot;d461f105-1792-407f-95ff-9a496fd918a9&quot;</span><span class="p">,</span>
 <span class="nt">&quot;threeDSMethodNotificationURL&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;Requestor callback URL&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Render a hidden HTML iframe in the Cardholder browser</p></li>
<li><p>Create a form with an input field named <code class="docutils literal notranslate"><span class="pre">threeDSMethodData</span></code></p></li>
<li><p>This field must contain the above JSON message, Base64-URL encoded</p></li>
<li><p>Post the form to the <code class="docutils literal notranslate"><span class="pre">threeDSMethodURL</span></code>, with the HTML iframe as a target</p></li>
</ol>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Add an iframe to the users browser, here using javascript</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">displayBox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;displayBox&#39;</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;hidden&#39;</span><span class="p">);</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;threeDSMethodIframe&quot;</span><span class="p">;</span>

<span class="nx">displayBox</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
</pre></div>
</div>
<p>Resulting in the following html</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;threeDSMethodIframe&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span><span class="p">/&gt;</span>
</pre></div>
</div>
<p>Create a HTML <code class="docutils literal notranslate"><span class="pre">form</span></code>, that contains the input field:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;threeDSMethodForm&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;threeDSMethodData&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;threeDSMethodData&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>This form can be submitted using the following javascript:</p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Generate the data object with required input values</span>
<span class="kd">let</span> <span class="nx">threeDSMethodData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">threeDSServerTransID</span><span class="o">:</span> <span class="s1">&#39;&lt;TRANS ID&gt;&#39;</span><span class="p">,</span>
  <span class="nx">threeDSMethodNotificationURL</span><span class="o">:</span> <span class="s1">&#39;&lt;URL&gt;&#39;</span>
<span class="p">}</span>

<span class="c1">// Get a reference to the form</span>
<span class="kd">let</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;threeDSMethodForm&#39;</span><span class="p">);</span>

<span class="c1">// 1. Serialize threeDSMethodData object into JSON</span>
<span class="c1">// 2. Base64-URL encode it</span>
<span class="c1">// 3. Store the value in the form input tag</span>
<span class="c1">// Notice: You have to define base64url() yourself.</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;threeDSMethodData&#39;</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span>
 <span class="nx">base64url</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">threeDSMethodData</span><span class="p">));</span>

<span class="c1">// Fill out the form information and submit.</span>
<span class="nx">form</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="s1">&#39;&lt;threeDSMethodURL&gt;&#39;</span><span class="p">;</span>
<span class="nx">form</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="s1">&#39;threeDSMethodIframe&#39;</span><span class="p">;</span> <span class="c1">// id of iframe</span>
<span class="nx">form</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span><span class="p">;</span>
<span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="completion">
<h2>Completion<a class="headerlink" href="#completion" title="Permalink to this headline">¶</a></h2>
<p>When the 3DS Method is finished, the hidden iframe will HTTP POST a form to the
<code class="docutils literal notranslate"><span class="pre">threeDSMethodNotificationURL</span></code>.</p>
<p>The POST body will contain the value <code class="docutils literal notranslate"><span class="pre">threeDSMethodData</span></code>,  which can used to
identify the request.
An example <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> body:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">threeDSMethodData</span><span class="o">=</span><span class="n">eyJ0aHJlZURTTWV0aG9kRGF0YSI6ICJkNDYxZjEwNS0xNzkyLTQwN2YtOTVmZi05YTQ5NmZkOTE4YTkifQ</span><span class="o">==</span>
</pre></div>
</div>
<p>The value is Base64-URL encoded and decodes to:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;threeDSServerTransID&quot;</span><span class="p">:</span> <span class="s2">&quot;d461f105-1792-407f-95ff-9a496fd918a9&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Continue the authentication with the <a class="reference internal" href="auth.html#auth-usage"><span class="std std-ref">/auth endpoint</span></a>, setting
<a class="reference external" href="specification_210.html#attr-AReq-threeDSCompInd">3DS Completion indicator</a> to <code class="docutils literal notranslate"><span class="pre">&quot;Y&quot;</span></code>.</p>
<div class="section" id="ds-method-failure">
<h3>3DS Method failure<a class="headerlink" href="#ds-method-failure" title="Permalink to this headline">¶</a></h3>
<p>If the callback to <code class="docutils literal notranslate"><span class="pre">threeDSMethodNotificationURL</span></code> is not received within 10
seconds from the POST call, it has failed.  Close the iframe and continue the
authentication with the <a class="reference internal" href="auth.html#auth-usage"><span class="std std-ref">/auth endpoint</span></a>, setting <a class="reference external" href="specification_210.html#attr-AReq-threeDSCompInd">3DS Completion indicator</a> to <code class="docutils literal notranslate"><span class="pre">&quot;N&quot;</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="challenge_flow.html" class="btn btn-neutral float-right" title="4.3. Challenge flow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="versioning.html" class="btn btn-neutral float-left" title="4.1. 3-D Secure version determination" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, 3DSecure.io

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>